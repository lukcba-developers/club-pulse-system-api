Rol Colectivo: Act煤en como un equipo de Staff Engineers y Product Designers expertos en Go (Clean Architecture). Su misi贸n es auditar el proyecto Club Pulse para llevarlo de un MVP a un sistema de alto rendimiento utilizando 煤nicamente PostgreSQL y Redis.

Restricci贸n de Oro: No se aceptan soluciones pagas de terceros. Si falta una funcionalidad (como B煤squeda Vectorial o Logs), se debe implementar sobre Postgres o Redis.

Instrucciones para Agentes:

Agente Arquitecto (Go & Redis Specialist):

Prop贸n un middleware de Rate Limiting basado en Redis para proteger la API (Sustituye a servicios de firewall costosos).

Redise帽a el almacenamiento de sesiones: Migra de JWT puro a Sesiones Persistidas en Redis para permitir el "Logout Global" y la revocaci贸n instant谩nea de tokens sin afectar el rendimiento de la DB.

Agente de Datos (Postgres & IA):

Implementa B煤squeda Sem谩ntica de Instalaciones usando la extensi贸n pgvector en Postgres. Esto permitir谩 a los usuarios buscar por lenguaje natural (ej: "canchas para jugar bajo la lluvia") sin usar Algolia o Pinecone.

Optimiza el motor de reservas: Prop贸n una funci贸n en PL/pgSQL o una consulta optimizada para detectar solapamientos (Overlap) en milisegundos.

Agente de UX e Innovaci贸n:

Dise帽a una "Capa de Inteligencia de Disponibilidad": Usa Redis para almacenar los slots de tiempo m谩s populares y sugerir al usuario horarios alternativos cuando haya un conflicto.

Prop贸n mejoras visuales para el Dashboard basadas en los datos reales de ocupaci贸n.

Agente L铆der (Sintetizador):

Crea una conclusi贸n unificada.

Genera un archivo docker-compose.yml optimizado para este stack.

Provee los fragmentos de c贸digo en Go para la integraci贸n de Redis en la capa de platform.

2. Lo que "se me ocurre" para mejorar tu MVP (Innovaci贸n Costo-Cero)
Dado tu stack, aqu铆 tienes tres mejoras disruptivas que los agentes pueden programar por ti para que el producto se sienta "Premium":

A. Buscador Inteligente con pgvector
En lugar de un buscador por nombre (LIKE %name%), pide al agente que use Postgres para embeddings.

Valor UX: El usuario busca "tenis noche" y el sistema le devuelve canchas de tenis con iluminaci贸n nocturna, aunque la palabra "noche" no est茅 en el t铆tulo.

Costo: $0 (es una extensi贸n gratuita de Postgres).

B. Notificaciones en Tiempo Real con Redis Pub/Sub
Como ya vas a tener Redis para la cach茅, 煤salo como un Message Broker.

Valor UX: Si un usuario cancela una reserva, otros usuarios interesados en esa cancha pueden recibir una notificaci贸n instant谩nea en el frontend sin que tengan que refrescar la p谩gina.

Implementaci贸n: Redis Pub/Sub integrado con WebSockets en Go.

C. Sistema de Auditor铆a "Zero-Impact"
Tu documentaci贸n menciona "Auditor铆a Auth".

Estrategia: En lugar de escribir en la DB principal cada vez que alguien hace login (lo cual a帽ade latencia), escribe los logs de auditor铆a en una Redis List de forma as铆ncrona. Un proceso en segundo plano (Worker) los mueve a Postgres cada 5 minutos.

Resultado: Login ultrarr谩pido y trazabilidad completa.

#  Hoja de Ruta de Refactorizaci贸n T茅cnica: Club Pulse (MVP Robusto)

Este documento detalla el plan de optimizaci贸n para el sistema **Club Pulse**, enfocado en maximizar el rendimiento utilizando exclusivamente **PostgreSQL** y **Redis**, eliminando costos de servicios externos y mejorando la experiencia de usuario (UX).

## 1. Fase de Infraestructura "Gasto Cero"
**Objetivo:** Consolidar el stack tecnol贸gico y preparar el entorno para alto rendimiento.

- [ ] **Configuraci贸n de Redis como Core State Store:**
    - Implementar Redis para gesti贸n de sesiones (reemplazando JWT stateless puro por tokens con estado).
    - Configurar Redis Pub/Sub para comunicaci贸n entre m贸dulos sin acoplamiento.
- [ ] **Optimizaci贸n de PostgreSQL:**
    - Habilitar extensi贸n `pgvector` para b煤squeda sem谩ntica.
    - Implementar 铆ndices GIST para la detecci贸n de solapamiento de rangos de tiempo (`tsrange`) en el m贸dulo de Booking.

## 2. Refactorizaci贸n de M贸dulos (Clean Architecture)

### A. M贸dulo de Autenticaci贸n & Seguridad
- **Cambio:** Migrar de "Blacklist de Tokens" a "Session Store" en Redis.
- **Beneficio:** Permite revocar sesiones instant谩neamente y mejora la seguridad ante robos de token.
- **Implementaci贸n:** Middleware en Go que verifique la existencia del `session_id` en Redis antes de procesar cada request.

### B. M贸dulo de Reservas (Booking) - El Motor del Sistema
- **Cambio:** Implementar validaci贸n de conflictos mediante exclusi贸n de rangos a nivel DB.
- **UX:** Crear un "Lock de Reserva Temporal" en Redis (TTL de 5 min) mientras el usuario completa el pago/proceso para evitar que le "roben" el slot en el 煤ltimo segundo.

### C. M贸dulo de Instalaciones (Facilities)
- **Cambio:** Integrar b煤squeda sem谩ntica.
- **UX:** El buscador ahora debe entender "Canchas techadas para lluvia" consultando el campo `specifications` (JSONB) mediante vectores.

## 3. Estrategia de UX e Innovaci贸n

| Funcionalidad | Implementaci贸n T茅cnica | Impacto en Usuario |
| :--- | :--- | :--- |
| **Reserva Instant谩nea** | Cach茅 de disponibilidad en Redis (Bitmap). | La disponibilidad se carga en <10ms. |
| **Notificaciones Live** | Redis Pub/Sub + WebSockets. | Actualizaciones de cancelaci贸n en tiempo real. |
| **Sugerencias Inteligentes** | Query de similitud en Postgres (`pgvector`). | "Te sugerimos esta cancha por su similitud a tus favoritas". |

## 4. Plan de Acci贸n (Sprint de 3 Pasos)

### Paso 1: Capa de Persistencia (D铆a 1)
Implementar el cliente de Redis en `internal/platform/redis` y configurar el pool de conexiones.

### Paso 2: L贸gica de Negocio (D铆a 2-3)
Refactorizar `internal/modules/booking/application` para incluir la l贸gica de bloqueo temporal en Redis y la validaci贸n de conflictos optimizada en Postgres.

### Paso 3: Integraci贸n de IA y Cierre (D铆a 4-5)
Generar los embeddings de las instalaciones actuales y habilitar el endpoint de b煤squeda inteligente. Implementar el Rate Limiter en Redis para proteger la API.

---
**Nota:** Este plan respeta la arquitectura de **Monolito Modular**, asegurando que cada cambio en la capa de `infrastructure` no rompa el `domain`.